{"version":3,"file":"waifu-tips.js","sources":["../build/message.js","../build/utils.js","../build/logger.js","../build/model.js","../build/tools.js","../build/icons.js","../build/vector.js","../build/conversation.js","../build/widget.js","../build/drag.js","../build/waifu-tips.js"],"sourcesContent":["let messageTimer = null;\nfunction showMessage(text, timeout, priority, override = true) {\n}\nfunction showSSEMessage(text, id, timeout = 60000) {\n    var _a;\n    const shadowRoot = (_a = document.getElementById('WENKO__CONTAINER-ROOT')) === null || _a === void 0 ? void 0 : _a.shadowRoot;\n    if (!shadowRoot)\n        return;\n    const tips = shadowRoot.getElementById('waifu-tips');\n    if (!tips)\n        return;\n    setTimeout(() => {\n        tips.scrollTop = tips.scrollHeight;\n    }, 0);\n    const currentSSEId = tips.getAttribute('data-sse-id');\n    if (currentSSEId === id) {\n        tips.innerHTML += text;\n    }\n    else {\n        tips.classList.remove('waifu-tips-active');\n        tips.removeAttribute('data-sse-id');\n        tips.innerHTML = text;\n        tips.setAttribute('data-sse-id', id);\n        setTimeout(() => {\n            tips.classList.add('waifu-tips-active');\n        }, 10);\n    }\n}\nfunction welcomeMessage(time, welcomeTemplate, referrerTemplate) {\n    if (location.pathname === '/') {\n        for (const { hour, text } of time) {\n            const now = new Date(), after = hour.split('-')[0], before = hour.split('-')[1] || after;\n            if (Number(after) <= now.getHours() &&\n                now.getHours() <= Number(before)) {\n                return text;\n            }\n        }\n    }\n    const text = i18n(welcomeTemplate, document.title);\n    if (document.referrer !== '') {\n        const referrer = new URL(document.referrer);\n        if (location.hostname === referrer.hostname)\n            return text;\n        return `${i18n(referrerTemplate, referrer.hostname)}<br>${text}`;\n    }\n    return text;\n}\nfunction i18n(template, ...args) {\n    return template.replace(/\\$(\\d+)/g, (_, idx) => {\n        var _a;\n        const i = parseInt(idx, 10) - 1;\n        return (_a = args[i]) !== null && _a !== void 0 ? _a : '';\n    });\n}\nexport { showMessage, showSSEMessage, welcomeMessage, i18n };\n","function randomSelection(obj) {\n    return Array.isArray(obj) ? obj[Math.floor(Math.random() * obj.length)] : obj;\n}\nfunction randomOtherOption(total, excludeIndex) {\n    const idx = Math.floor(Math.random() * (total - 1));\n    return idx >= excludeIndex ? idx + 1 : idx;\n}\nfunction loadExternalResource(url, type) {\n    return new Promise((resolve, reject) => {\n        let tag;\n        if (type === 'css') {\n            tag = document.createElement('link');\n            tag.rel = 'stylesheet';\n            tag.href = url;\n        }\n        else if (type === 'js') {\n            tag = document.createElement('script');\n            tag.src = url;\n        }\n        if (tag) {\n            tag.onload = () => resolve(url);\n            tag.onerror = () => reject(url);\n            document.head.appendChild(tag);\n        }\n    });\n}\nexport const generateMsgId = () => {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n};\nconst LocalStoreage_Key = 'live2d-widget';\nexport const setLocalStorage = (key, value, expire) => {\n    const data = {\n        value,\n        expire: Date.now() + expire * 1000,\n    };\n    localStorage.setItem(`${LocalStoreage_Key}-${key}`, JSON.stringify(data));\n};\nexport const getLocalStorage = (key) => {\n    const data = localStorage.getItem(`${LocalStoreage_Key}-${key}`);\n    if (data) {\n        const { value, expire } = JSON.parse(data);\n        if (Date.now() < expire) {\n            return value;\n        }\n    }\n    return null;\n};\nexport const writeOptions = (options) => {\n    const oldOptions = getLocalStorage('options');\n    if (oldOptions) {\n        options = Object.assign(Object.assign({}, oldOptions), options);\n    }\n    console.info('<wenko> 写入选项:', options);\n    setLocalStorage('options', options, 3600 * 24 * 30);\n};\nexport const readOptions = () => {\n    return getLocalStorage('options');\n};\nexport { randomSelection, loadExternalResource, randomOtherOption, };\n","class Logger {\n    constructor(level = 'info') {\n        this.level = level;\n    }\n    setLevel(level) {\n        if (!level)\n            return;\n        this.level = level;\n    }\n    shouldLog(level) {\n        return Logger.levelOrder[level] <= Logger.levelOrder[this.level];\n    }\n    error(message, ...args) {\n        if (this.shouldLog('error')) {\n            console.error('[Live2D Widget][ERROR]', message, ...args);\n        }\n    }\n    warn(message, ...args) {\n        if (this.shouldLog('warn')) {\n            console.warn('[Live2D Widget][WARN]', message, ...args);\n        }\n    }\n    info(message, ...args) {\n        if (this.shouldLog('info')) {\n            console.log('[Live2D Widget][INFO]', message, ...args);\n        }\n    }\n    trace(message, ...args) {\n        if (this.shouldLog('trace')) {\n            console.log('[Live2D Widget][TRACE]', message, ...args);\n        }\n    }\n}\nLogger.levelOrder = {\n    error: 0,\n    warn: 1,\n    info: 2,\n    trace: 3,\n};\nconst logger = new Logger();\nexport default logger;\n","import { showMessage } from './message.js';\nimport { loadExternalResource, randomOtherOption } from './utils.js';\nimport logger from './logger.js';\nclass ModelManager {\n    constructor(config, models = []) {\n        var _a;\n        this.modelList = null;\n        let { apiPath, cdnPath } = config;\n        const { cubism2Path, cubism5Path } = config;\n        let useCDN = false;\n        if (typeof cdnPath === 'string') {\n            if (!cdnPath.endsWith('/'))\n                cdnPath += '/';\n            useCDN = true;\n        }\n        else if (typeof apiPath === 'string') {\n            if (!apiPath.endsWith('/'))\n                apiPath += '/';\n            cdnPath = apiPath;\n            useCDN = true;\n            logger.warn('apiPath option is deprecated. Please use cdnPath instead.');\n        }\n        else if (!models.length) {\n            throw 'Invalid initWidget argument!';\n        }\n        let modelId = parseInt(localStorage.getItem('modelId'), 10);\n        let modelTexturesId = parseInt(localStorage.getItem('modelTexturesId'), 10);\n        if (isNaN(modelId) || isNaN(modelTexturesId)) {\n            modelTexturesId = 0;\n        }\n        if (isNaN(modelId)) {\n            modelId = (_a = config.modelId) !== null && _a !== void 0 ? _a : 0;\n        }\n        this.useCDN = useCDN;\n        this.cdnPath = cdnPath || '';\n        this.cubism2Path = cubism2Path || '';\n        this.cubism5Path = cubism5Path || '';\n        this._modelId = modelId;\n        this._modelTexturesId = modelTexturesId;\n        this.currentModelVersion = 0;\n        this.loading = false;\n        this.modelJSONCache = {};\n        this.models = models;\n    }\n    static async initCheck(config, models = []) {\n        const model = new ModelManager(config, models);\n        if (model.useCDN) {\n            const response = await fetch(`${model.cdnPath}model_list.json`);\n            model.modelList = await response.json();\n            if (model.modelId >= model.modelList.models.length) {\n                model.modelId = 0;\n            }\n            const modelName = model.modelList.models[model.modelId];\n            if (Array.isArray(modelName)) {\n                if (model.modelTexturesId >= modelName.length) {\n                    model.modelTexturesId = 0;\n                }\n            }\n            else {\n                const modelSettingPath = `${model.cdnPath}model/${modelName}/index.json`;\n                const modelSetting = await model.fetchWithCache(modelSettingPath);\n                const version = model.checkModelVersion(modelSetting);\n                if (version === 2) {\n                    const textureCache = await model.loadTextureCache(modelName);\n                    if (model.modelTexturesId >= textureCache.length) {\n                        model.modelTexturesId = 0;\n                    }\n                }\n            }\n        }\n        else {\n            if (model.modelId >= model.models.length) {\n                model.modelId = 0;\n            }\n            if (model.modelTexturesId >= model.models[model.modelId].paths.length) {\n                model.modelTexturesId = 0;\n            }\n        }\n        return model;\n    }\n    set modelId(modelId) {\n        this._modelId = modelId;\n        localStorage.setItem('modelId', modelId.toString());\n    }\n    get modelId() {\n        return this._modelId;\n    }\n    set modelTexturesId(modelTexturesId) {\n        this._modelTexturesId = modelTexturesId;\n        localStorage.setItem('modelTexturesId', modelTexturesId.toString());\n    }\n    get modelTexturesId() {\n        return this._modelTexturesId;\n    }\n    resetCanvas() {\n        var _a;\n        const shadowRoot = (_a = document.getElementById('WENKO__CONTAINER-ROOT')) === null || _a === void 0 ? void 0 : _a.shadowRoot;\n        shadowRoot.getElementById('waifu-canvas').innerHTML = '<canvas id=\"live2d\" width=\"800\" height=\"800\"></canvas>';\n    }\n    async fetchWithCache(url) {\n        let result;\n        if (url in this.modelJSONCache) {\n            result = this.modelJSONCache[url];\n        }\n        else {\n            try {\n                const response = await fetch(url);\n                result = await response.json();\n            }\n            catch (_a) {\n                result = null;\n            }\n            this.modelJSONCache[url] = result;\n        }\n        return result;\n    }\n    checkModelVersion(modelSetting) {\n        if (modelSetting.Version === 3 || modelSetting.FileReferences) {\n            return 3;\n        }\n        return 2;\n    }\n    async loadLive2D(modelSettingPath, modelSetting) {\n        if (this.loading) {\n            logger.warn('Still loading. Abort.');\n            return;\n        }\n        this.loading = true;\n        try {\n            const version = this.checkModelVersion(modelSetting);\n            if (version === 2) {\n                if (!this.cubism2model) {\n                    if (!this.cubism2Path) {\n                        logger.error('No cubism2Path set, cannot load Cubism 2 Core.');\n                        return;\n                    }\n                    await loadExternalResource(this.cubism2Path, 'js');\n                    const { default: Cubism2Model } = await import('./cubism2/index.js');\n                    this.cubism2model = new Cubism2Model();\n                }\n                if (this.currentModelVersion === 3) {\n                    this.cubism5model.release();\n                    this.resetCanvas();\n                }\n                if (this.currentModelVersion === 3 || !this.cubism2model.gl) {\n                    await this.cubism2model.init('live2d', modelSettingPath, modelSetting);\n                }\n                else {\n                    await this.cubism2model.changeModelWithJSON(modelSettingPath, modelSetting);\n                }\n            }\n            else {\n                if (!this.cubism5Path) {\n                    logger.error('No cubism5Path set, cannot load Cubism 5 Core.');\n                    return;\n                }\n                await loadExternalResource(this.cubism5Path, 'js');\n                const { AppDelegate: Cubism5Model } = await import('./cubism5/index.js');\n                this.cubism5model = new Cubism5Model();\n                if (this.currentModelVersion === 2) {\n                    this.cubism2model.destroy();\n                    this.resetCanvas();\n                }\n                if (this.currentModelVersion === 2 || !this.cubism5model.subdelegates.at(0)) {\n                    this.cubism5model.initialize();\n                    this.cubism5model.changeModel(modelSettingPath);\n                    this.cubism5model.run();\n                }\n                else {\n                    this.cubism5model.changeModel(modelSettingPath);\n                }\n            }\n            logger.info(`Model ${modelSettingPath} (Cubism version ${version}) loaded`);\n            this.currentModelVersion = version;\n        }\n        catch (err) {\n            console.error('loadLive2D failed', err);\n        }\n        this.loading = false;\n    }\n    async loadTextureCache(modelName) {\n        const textureCache = await this.fetchWithCache(`${this.cdnPath}model/${modelName}/textures.cache`);\n        return textureCache || [];\n    }\n    async loadModel(message) {\n        let modelSettingPath, modelSetting;\n        if (this.useCDN) {\n            let modelName = this.modelList.models[this.modelId];\n            if (Array.isArray(modelName)) {\n                modelName = modelName[this.modelTexturesId];\n            }\n            modelSettingPath = `${this.cdnPath}model/${modelName}/index.json`;\n            modelSetting = await this.fetchWithCache(modelSettingPath);\n            const version = this.checkModelVersion(modelSetting);\n            if (version === 2) {\n                const textureCache = await this.loadTextureCache(modelName);\n                if (textureCache.length > 0) {\n                    let textures = textureCache[this.modelTexturesId];\n                    if (typeof textures === 'string')\n                        textures = [textures];\n                    modelSetting.textures = textures;\n                }\n            }\n        }\n        else {\n            modelSettingPath = this.models[this.modelId].paths[this.modelTexturesId];\n            modelSetting = await this.fetchWithCache(modelSettingPath);\n        }\n        await this.loadLive2D(modelSettingPath, modelSetting);\n        showMessage(message, 4000, 10);\n    }\n    async loadRandTexture(successMessage = '', failMessage = '') {\n        const { modelId } = this;\n        let noTextureAvailable = false;\n        if (this.useCDN) {\n            const modelName = this.modelList.models[modelId];\n            if (Array.isArray(modelName)) {\n                this.modelTexturesId = randomOtherOption(modelName.length, this.modelTexturesId);\n            }\n            else {\n                const modelSettingPath = `${this.cdnPath}model/${modelName}/index.json`;\n                const modelSetting = await this.fetchWithCache(modelSettingPath);\n                const version = this.checkModelVersion(modelSetting);\n                if (version === 2) {\n                    const textureCache = await this.loadTextureCache(modelName);\n                    if (textureCache.length <= 1) {\n                        noTextureAvailable = true;\n                    }\n                    else {\n                        this.modelTexturesId = randomOtherOption(textureCache.length, this.modelTexturesId);\n                    }\n                }\n                else {\n                    noTextureAvailable = true;\n                }\n            }\n        }\n        else {\n            if (this.models[modelId].paths.length === 1) {\n                noTextureAvailable = true;\n            }\n            else {\n                this.modelTexturesId = randomOtherOption(this.models[modelId].paths.length, this.modelTexturesId);\n            }\n        }\n        if (noTextureAvailable) {\n            showMessage(failMessage, 4000, 10);\n        }\n        else {\n            await this.loadModel(successMessage);\n        }\n    }\n    async loadNextModel() {\n        this.modelTexturesId = 0;\n        if (this.useCDN) {\n            this.modelId = (this.modelId + 1) % this.modelList.models.length;\n            await this.loadModel(this.modelList.messages[this.modelId]);\n        }\n        else {\n            this.modelId = (this.modelId + 1) % this.models.length;\n            await this.loadModel(this.models[this.modelId].message);\n        }\n    }\n}\nexport { ModelManager };\n","import { fa_comment, fa_paper_plane, fa_street_view, fa_shirt, fa_camera_retro, fa_info_circle, fa_xmark } from './icons.js';\nimport { showMessage, i18n } from './message.js';\nclass ToolsManager {\n    constructor(model, config, tips) {\n        this.config = config;\n        this.tools = {\n            hitokoto: {\n                icon: fa_comment,\n                callback: async () => {\n                    const response = await fetch('https://v1.hitokoto.cn');\n                    const result = await response.json();\n                    const template = tips.message.hitokoto;\n                    const text = i18n(template, result.from, result.creator);\n                    showMessage(result.hitokoto, 6000, 9);\n                    setTimeout(() => {\n                        showMessage(text, 4000, 9);\n                    }, 6000);\n                }\n            },\n            asteroids: {\n                icon: fa_paper_plane,\n                callback: () => {\n                    if (window.Asteroids) {\n                        if (!window.ASTEROIDSPLAYERS)\n                            window.ASTEROIDSPLAYERS = [];\n                        window.ASTEROIDSPLAYERS.push(new window.Asteroids());\n                    }\n                    else {\n                        const script = document.createElement('script');\n                        script.src =\n                            'https://fastly.jsdelivr.net/gh/stevenjoezhang/asteroids/asteroids.js';\n                        document.head.appendChild(script);\n                    }\n                }\n            },\n            'switch-model': {\n                icon: fa_street_view,\n                callback: () => model.loadNextModel()\n            },\n            'switch-texture': {\n                icon: fa_shirt,\n                callback: () => {\n                    let successMessage = '', failMessage = '';\n                    if (tips) {\n                        successMessage = tips.message.changeSuccess;\n                        failMessage = tips.message.changeFail;\n                    }\n                    model.loadRandTexture(successMessage, failMessage);\n                }\n            },\n            photo: {\n                icon: fa_camera_retro,\n                callback: () => {\n                    const message = tips.message.photo;\n                    showMessage(message, 6000, 9);\n                    const canvas = document.getElementById('live2d');\n                    if (!canvas)\n                        return;\n                    const imageUrl = canvas.toDataURL();\n                    const link = document.createElement('a');\n                    link.style.display = 'none';\n                    link.href = imageUrl;\n                    link.download = 'live2d-photo.png';\n                    document.body.appendChild(link);\n                    link.click();\n                    document.body.removeChild(link);\n                }\n            },\n            info: {\n                icon: fa_info_circle,\n                callback: () => {\n                    open('https://github.com/stevenjoezhang/live2d-widget');\n                }\n            },\n            quit: {\n                icon: fa_xmark,\n                callback: () => {\n                    localStorage.setItem('waifu-display', Date.now().toString());\n                    const message = tips.message.goodbye;\n                    showMessage(message, 2000, 11);\n                    const waifu = document.getElementById('waifu');\n                    if (!waifu)\n                        return;\n                    waifu.classList.remove('waifu-active');\n                    setTimeout(() => {\n                        waifu.classList.add('waifu-hidden');\n                        const waifuToggle = document.getElementById('waifu-toggle');\n                        waifuToggle === null || waifuToggle === void 0 ? void 0 : waifuToggle.classList.add('waifu-toggle-active');\n                    }, 3000);\n                }\n            }\n        };\n    }\n    registerTools() {\n        if (!Array.isArray(this.config.tools)) {\n            this.config.tools = Object.keys(this.tools);\n        }\n    }\n}\nexport { ToolsManager };\n","const fa_comment = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M512 240c0 114.9-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6C73.6 471.1 44.7 480 16 480c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4c0 0 0 0 0 0s0 0 0 0s0 0 0 0c0 0 0 0 0 0l.3-.3c.3-.3 .7-.7 1.3-1.4c1.1-1.2 2.8-3.1 4.9-5.7c4.1-5 9.6-12.4 15.2-21.6c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208z\"/></svg>';\nconst fa_paper_plane = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480l0-83.6c0-4 1.5-7.8 4.2-10.8L331.8 202.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z\"/></svg>';\nconst fa_street_view = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M320 64A64 64 0 1 0 192 64a64 64 0 1 0 128 0zm-96 96c-35.3 0-64 28.7-64 64l0 48c0 17.7 14.3 32 32 32l1.8 0 11.1 99.5c1.8 16.2 15.5 28.5 31.8 28.5l38.7 0c16.3 0 30-12.3 31.8-28.5L318.2 304l1.8 0c17.7 0 32-14.3 32-32l0-48c0-35.3-28.7-64-64-64l-64 0zM132.3 394.2c13-2.4 21.7-14.9 19.3-27.9s-14.9-21.7-27.9-19.3c-32.4 5.9-60.9 14.2-82 24.8c-10.5 5.3-20.3 11.7-27.8 19.6C6.4 399.5 0 410.5 0 424c0 21.4 15.5 36.1 29.1 45c14.7 9.6 34.3 17.3 56.4 23.4C130.2 504.7 190.4 512 256 512s125.8-7.3 170.4-19.6c22.1-6.1 41.8-13.8 56.4-23.4c13.7-8.9 29.1-23.6 29.1-45c0-13.5-6.4-24.5-14-32.6c-7.5-7.9-17.3-14.3-27.8-19.6c-21-10.6-49.5-18.9-82-24.8c-13-2.4-25.5 6.3-27.9 19.3s6.3 25.5 19.3 27.9c30.2 5.5 53.7 12.8 69 20.5c3.2 1.6 5.8 3.1 7.9 4.5c3.6 2.4 3.6 7.2 0 9.6c-8.8 5.7-23.1 11.8-43 17.3C374.3 457 318.5 464 256 464s-118.3-7-157.7-17.9c-19.9-5.5-34.2-11.6-43-17.3c-3.6-2.4-3.6-7.2 0-9.6c2.1-1.4 4.8-2.9 7.9-4.5c15.3-7.7 38.8-14.9 69-20.5z\"/></svg>';\nconst fa_shirt = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M211.8 0c7.8 0 14.3 5.7 16.7 13.2C240.8 51.9 277.1 80 320 80s79.2-28.1 91.5-66.8C413.9 5.7 420.4 0 428.2 0l12.6 0c22.5 0 44.2 7.9 61.5 22.3L628.5 127.4c6.6 5.5 10.7 13.5 11.4 22.1s-2.1 17.1-7.8 23.6l-56 64c-11.4 13.1-31.2 14.6-44.6 3.5L480 197.7 480 448c0 35.3-28.7 64-64 64l-192 0c-35.3 0-64-28.7-64-64l0-250.3-51.5 42.9c-13.3 11.1-33.1 9.6-44.6-3.5l-56-64c-5.7-6.5-8.5-15-7.8-23.6s4.8-16.6 11.4-22.1L137.7 22.3C155 7.9 176.7 0 199.2 0l12.6 0z\"/></svg>';\nconst fa_camera_retro = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M220.6 121.2L271.1 96 448 96l0 96-114.8 0c-21.9-15.1-48.5-24-77.2-24s-55.2 8.9-77.2 24L64 192l0-64 128 0c9.9 0 19.7-2.3 28.6-6.8zM0 128L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L271.1 32c-9.9 0-19.7 2.3-28.6 6.8L192 64l-32 0 0-16c0-8.8-7.2-16-16-16L80 32c-8.8 0-16 7.2-16 16l0 16C28.7 64 0 92.7 0 128zM168 304a88 88 0 1 1 176 0 88 88 0 1 1 -176 0z\"/></svg>';\nconst fa_info_circle = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z\"/></svg>';\nconst fa_xmark = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z\"/></svg>';\nconst fa_child = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 320 512\"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc. --><path d=\"M96 64a64 64 0 1 1 128 0A64 64 0 1 1 96 64zm48 320l0 96c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-192.2L59.1 321c-9.4 15-29.2 19.4-44.1 10S-4.5 301.9 4.9 287l39.9-63.3C69.7 184 113.2 160 160 160s90.3 24 115.2 63.6L315.1 287c9.4 15 4.9 34.7-10 44.1s-34.7 4.9-44.1-10L240 287.8 240 480c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-96-32 0z\"/></svg>';\nexport { fa_comment, fa_paper_plane, fa_street_view, fa_shirt, fa_camera_retro, fa_info_circle, fa_xmark, fa_child };\n","export const generate = (input) => {\n    const { texts, original = '', } = input;\n    return new Promise((resolve, reject) => {\n        fetch(\"http://localhost:8080/generate\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n                texts,\n                original,\n            }),\n        })\n            .then((res) => res.json())\n            .then((res) => {\n            if (res.id) {\n                const text = `😊 Generated [id ${res.id}]`;\n                resolve(text);\n            }\n            else {\n                const text = '😂 Save Text failed';\n                reject(text);\n            }\n        })\n            .catch(err => {\n            const text = '😂 Save Text error: ' + err;\n            reject(text);\n        });\n    });\n};\nexport const search = (input) => {\n    return new Promise((resolve, reject) => {\n        fetch(\"http://localhost:8080/search\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n                texts: input,\n            }),\n        })\n            .then((res) => res.json())\n            .then((data) => {\n            resolve(data);\n        })\n            .catch(err => {\n            const text = '😂 Search error: ' + err;\n            reject(text);\n        });\n    });\n};\n","import { fetchEventSource } from \"https://esm.sh/@microsoft/fetch-event-source\";\nimport { generateMsgId } from \"./utils.js\";\nimport { generate, search } from \"./vector.js\";\nexport const getKanbanDaily = (text, callback, loadingCallback, doneCallback) => {\n    let interval = setInterval(() => {\n        loadingCallback && loadingCallback('.');\n    }, 1000);\n    let out = '';\n    setTimeout(() => {\n        fetchEventSource('http://localhost:8080/task', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n                id: generateMsgId(),\n                text,\n            }),\n            onopen: (res) => {\n                console.log('open', res);\n                if (res.ok)\n                    return Promise.resolve();\n            },\n            onmessage: (line) => {\n                if (interval) {\n                    clearInterval(interval);\n                    interval = null;\n                }\n                try {\n                    if (line.event !== 'text')\n                        return;\n                    const data = JSON.parse(line.data);\n                    if (data.type !== 'text')\n                        return;\n                    const payload = data.payload;\n                    if (payload.type !== 'text')\n                        return;\n                    out += payload.content;\n                    callback(payload.content);\n                }\n                catch (error) {\n                    console.error(error);\n                }\n            },\n            onclose: () => {\n                doneCallback && doneCallback();\n            },\n            onerror: (err) => {\n                console.log('error', err);\n            },\n        });\n    }, 1500);\n};\nexport const getWeightedTexts = (text) => {\n    return [\n        { Text: text, Weight: 0.6 },\n        { Text: document.title, Weight: 0.2 },\n        { Text: location.href, Weight: 0.1 },\n        { Text: new Date().getTime().toString(), Weight: 0.1 },\n    ];\n};\nexport const getSearch = (text, callback, loadingCallback) => {\n    let interval = setInterval(() => {\n        loadingCallback && loadingCallback('.');\n    }, 1000);\n    const weightedTexts = getWeightedTexts(text);\n    generate(weightedTexts)\n        .then(res => {\n        clearInterval(interval);\n        callback(res);\n    })\n        .catch((err) => {\n        console.error('❌ 生成向量失败', err);\n        clearInterval(interval);\n        callback('😂 Save Text error');\n    });\n};\nexport const saveHightlightText = (text, callback, loadingCallback) => {\n    let interval = setInterval(() => {\n        loadingCallback && loadingCallback('.');\n    }, 1000);\n    const weightedTexts = getWeightedTexts(text);\n    fetch(\"http://localhost:8080/generate\", {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n            texts: weightedTexts,\n        }),\n    })\n        .then((res) => res.json())\n        .then((res) => {\n        interval && clearInterval(interval);\n        if (res.id) {\n            const text = `😊 Generated [id ${res.id}]`;\n            callback(text);\n        }\n        else {\n            callback('😂 Save Text failed');\n        }\n    })\n        .catch(err => {\n        console.error('❌ 生成向量失败', err);\n        interval && clearInterval(interval);\n        callback('😂 Save Text error');\n    });\n};\nexport const saveDaily = (callback, loadingCallback) => {\n    let interval = setInterval(() => {\n        loadingCallback && loadingCallback('.');\n    }, 1000);\n    const weightedTexts = [\n        { Text: document.title, Weight: 0.3 },\n        { Text: location.href, Weight: 0.4 },\n        { Text: new Date().getTime().toString(), Weight: 0.3 },\n    ];\n    const original = {\n        title: document.title,\n        url: location.href,\n        time: new Date().getTime().toString(),\n    };\n    generate({\n        texts: weightedTexts,\n        original: JSON.stringify(original),\n    })\n        .then(res => {\n        clearInterval(interval);\n        callback(res);\n    })\n        .catch((err) => {\n        console.error('❌ 保存用户行为失败', err);\n        clearInterval(interval);\n        callback('😂 Save User Behavior error');\n    });\n};\nexport const getDaily = (callback, loadingCallback, doneCallback) => {\n    let interval = setInterval(() => {\n        loadingCallback && loadingCallback('.');\n    }, 1000);\n    const weightedTexts = [\n        { Text: document.title, Weight: 0.3 },\n        { Text: location.href, Weight: 0.4 },\n        { Text: new Date().getTime().toString(), Weight: 0.3 },\n    ];\n    search(weightedTexts)\n        .then(res => {\n        clearInterval(interval);\n        if (!Array.isArray(res))\n            return;\n        const texts = res.map(item => {\n            const arr = item.content.split('-$-$');\n            return {\n                title: arr[0].replace(/\\(weight-assign:.*?\\)/, ''),\n                url: arr[1].replace(/\\(weight-assign:.*?\\)/, ''),\n                time: arr[2].replace(/\\(weight-assign:.*?\\)/, ''),\n            };\n        });\n        const content = document.body.innerText.replace(/\\n/g, ' ').replace(/\\s+/g, ' ').substring(0, 500);\n        const userInput = `\n${texts.map(item => {\n            return `\n    用户在 时间：${item.time} 访问了网页：标题： ${item.title}，地址：(${item.url})，\n    `;\n        }).join('\\n')}\n当前访问内容：${content}\n`;\n        console.log('📝 userInput', userInput);\n        fetchEventSource('http://localhost:8080/task', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n            body: JSON.stringify({\n                id: generateMsgId(),\n                text: userInput,\n            }),\n            onopen: (res) => {\n                console.log('open', res);\n                if (res.ok)\n                    return Promise.resolve();\n            },\n            onmessage: (line) => {\n                if (interval) {\n                    clearInterval(interval);\n                    interval = null;\n                }\n                try {\n                    if (line.event !== 'text')\n                        return;\n                    const data = JSON.parse(line.data);\n                    if (data.type !== 'text')\n                        return;\n                    const payload = data.payload;\n                    if (payload.type !== 'text')\n                        return;\n                    callback(payload.content);\n                }\n                catch (error) {\n                    console.error(error);\n                }\n            },\n            onclose: () => {\n                doneCallback && doneCallback();\n            },\n            onerror: (err) => {\n                console.log('error', err);\n            },\n        });\n    })\n        .catch((err) => {\n        console.error('❌ 查询用户行为失败', err);\n        clearInterval(interval);\n        callback('😂 Search User Behavior error');\n    });\n};\n","import { ModelManager } from './model.js';\nimport { showMessage, showSSEMessage } from './message.js';\nimport { randomSelection, writeOptions, readOptions, } from './utils.js';\nimport { ToolsManager } from './tools.js';\nimport logger from './logger.js';\nimport registerDrag from './drag.js';\nimport { getKanbanDaily, getDaily, saveHightlightText as saveText, saveDaily, } from './conversation.js';\nfunction registerEventListener(tips) {\n    var _a;\n    let userAction = false;\n    let userActionTimer;\n    const messageArray = tips.message.default;\n    tips.seasons.forEach(({ date, text }) => {\n        const now = new Date(), after = date.split('-')[0], before = date.split('-')[1] || after;\n        if (Number(after.split('/')[0]) <= now.getMonth() + 1 &&\n            now.getMonth() + 1 <= Number(before.split('/')[0]) &&\n            Number(after.split('/')[1]) <= now.getDate() &&\n            now.getDate() <= Number(before.split('/')[1])) {\n            text = randomSelection(text);\n            text = text.replace('{year}', String(now.getFullYear()));\n            messageArray.push(text);\n        }\n    });\n    let lastHoverElement;\n    window.addEventListener('mousemove', () => (userAction = true));\n    window.addEventListener('keydown', () => (userAction = true));\n    setInterval(() => {\n        if (userAction) {\n            userAction = false;\n            clearInterval(userActionTimer);\n            userActionTimer = null;\n        }\n        else if (!userActionTimer) {\n            userActionTimer = setInterval(() => {\n                showMessage(messageArray, 6000, 9);\n            }, 20000);\n        }\n    }, 1000);\n    window.addEventListener('mouseover', (event) => {\n        var _a;\n        for (let { selector, text } of tips.mouseover) {\n            if (!((_a = event.target) === null || _a === void 0 ? void 0 : _a.closest(selector)))\n                continue;\n            if (lastHoverElement === selector)\n                return;\n            lastHoverElement = selector;\n            text = randomSelection(text);\n            text = text.replace('{text}', event.target.innerText);\n            showMessage(text, 4000, 8);\n            return;\n        }\n    });\n    let dblclickLoading = false;\n    window.addEventListener('dblclick', (event) => {\n        const target = event.target;\n        if (!target)\n            return;\n        let isInContainer = false;\n        if (target.closest) {\n            isInContainer = !!target.closest('#WENKO__CONTAINER-ROOT');\n        }\n        else {\n            let current = target;\n            while (current) {\n                if (current.id === 'WENKO__CONTAINER-ROOT') {\n                    isInContainer = true;\n                    break;\n                }\n                current = current.parentElement;\n            }\n        }\n        if (!isInContainer)\n            return;\n        if (dblclickLoading)\n            return;\n        dblclickLoading = true;\n        getDaily(str => {\n            showSSEMessage(str, 'wenko-daily');\n        }, str => {\n            showSSEMessage(str, 'wenko-daily-loading');\n        }, () => {\n            dblclickLoading = false;\n        });\n    });\n    window.addEventListener('live2d:hoverbody', () => {\n        console.info('>>> live2d:hoverbody');\n        const text = randomSelection(tips.message.hoverBody);\n        showMessage(text, 4000, 8, false);\n    });\n    window.addEventListener('live2d:tapbody', () => {\n        console.info('>>> live2d:tapbody');\n        const text = randomSelection(tips.message.tapBody);\n        showMessage(text, 4000, 9);\n    });\n    const devtools = () => { };\n    devtools.toString = () => {\n        showMessage(tips.message.console, 6000, 9);\n    };\n    window.addEventListener('copy', () => {\n        showMessage(tips.message.copy, 6000, 9);\n    });\n    window.addEventListener('visibilitychange', () => {\n        if (!document.hidden)\n            showMessage(tips.message.visibilitychange, 6000, 9);\n    });\n    window.addEventListener('wenko_highlight', (event) => {\n        let text = event.detail;\n        getKanbanDaily(text, str => {\n            showSSEMessage(str, 'wenko_highlight');\n        }, str => {\n            showSSEMessage(str, 'wenko_highlight_loading');\n        });\n    });\n    window.addEventListener('wenko_saveText', (event) => {\n        let text = event.detail;\n        saveText(text, (str) => {\n            showSSEMessage(str, 'wenko_saveText');\n        }, str => {\n            showSSEMessage(str, 'wenko_saveText_loading');\n        });\n    });\n    const shadowRoot = (_a = document.getElementById('WENKO__CONTAINER-ROOT')) === null || _a === void 0 ? void 0 : _a.shadowRoot;\n    shadowRoot\n        .getElementById('waifu-tips')\n        .addEventListener('click', function (e) {\n        const tool = this;\n        const rect = tool.getBoundingClientRect();\n        if (e.clientX >= rect.right - 25 &&\n            e.clientX <= rect.right - 5 &&\n            e.clientY >= rect.top + 5 &&\n            e.clientY <= rect.top + 25) {\n            shadowRoot\n                .getElementById('waifu-tips').classList.remove('waifu-tips-active');\n        }\n    });\n}\nfunction getShadowRootMounted() {\n    var _a;\n    const shadowRoot = (_a = document.getElementById('WENKO__CONTAINER-ROOT')) === null || _a === void 0 ? void 0 : _a.shadowRoot;\n    if (shadowRoot) {\n        const mounted = shadowRoot.getElementById('wenko_wifu');\n        if (mounted) {\n            return mounted;\n        }\n    }\n    return null;\n}\nasync function loadWidget(config) {\n    window.addEventListener('wenko_popup', async (event) => {\n        var _a;\n        writeOptions(event.detail);\n        const options = readOptions();\n        if (options === null || options === void 0 ? void 0 : options.pauseUse) {\n            console.info('<wenko> 暂停使用');\n            const mounted = getShadowRootMounted();\n            if (mounted) {\n                mounted.innerHTML = '';\n            }\n            return;\n        }\n        localStorage.removeItem('waifu-display');\n        sessionStorage.removeItem('waifu-message-priority');\n        const mounted = getShadowRootMounted();\n        mounted.insertAdjacentHTML('beforeend', `<div id=\"waifu\">\n        <div id=\"waifu-tips\"></div>\n        <div id=\"waifu-canvas\">\n          <canvas id=\"live2d\" width=\"800\" height=\"800\"></canvas>\n        </div>\n        <div id=\"waifu-tool\"></div>\n      </div>`);\n        let models = [];\n        let tips;\n        if (config.waifuPath) {\n            const response = await fetch(config.waifuPath);\n            tips = await response.json();\n            models = tips.models;\n            registerEventListener(tips);\n            const options = readOptions();\n            if (!(options === null || options === void 0 ? void 0 : options.pauseRecord)) {\n                saveDaily(message => {\n                    showSSEMessage(message, 'wenko_saveDaily');\n                });\n            }\n        }\n        const model = await ModelManager.initCheck(config, models);\n        await model.loadModel('');\n        new ToolsManager(model, config, tips).registerTools();\n        if (config.drag)\n            registerDrag();\n        (_a = document.getElementById('waifu')) === null || _a === void 0 ? void 0 : _a.classList.add('waifu-active');\n    });\n}\nfunction initWidget(config) {\n    if (typeof config === 'string') {\n        logger.error('Your config for Live2D initWidget is outdated. Please refer to https://github.com/stevenjoezhang/live2d-widget/blob/master/dist/autoload.js');\n        return;\n    }\n    logger.setLevel(config.logLevel);\n    loadWidget(config);\n}\nexport { initWidget };\n","function registerDrag() {\n    const element = document.getElementById('waifu');\n    if (!element)\n        return;\n    let winWidth = window.innerWidth, winHeight = window.innerHeight;\n    const imgWidth = element.offsetWidth, imgHeight = element.offsetHeight;\n    element.addEventListener('mousedown', event => {\n        if (event.button === 2) {\n            return;\n        }\n        const canvas = document.getElementById('live2d');\n        if (event.target !== canvas)\n            return;\n        event.preventDefault();\n        const _offsetX = event.offsetX, _offsetY = event.offsetY;\n        document.onmousemove = event => {\n            const _x = event.clientX, _y = event.clientY;\n            let _left = _x - _offsetX, _top = _y - _offsetY;\n            if (_top < 0) {\n                _top = 0;\n            }\n            else if (_top >= winHeight - imgHeight) {\n                _top = winHeight - imgHeight;\n            }\n            if (_left < 0) {\n                _left = 0;\n            }\n            else if (_left >= winWidth - imgWidth) {\n                _left = winWidth - imgWidth;\n            }\n            element.style.top = _top + 'px';\n            element.style.left = _left + 'px';\n        };\n        document.onmouseup = () => {\n            document.onmousemove = null;\n        };\n    });\n    window.onresize = () => {\n        winWidth = window.innerWidth;\n        winHeight = window.innerHeight;\n    };\n}\nexport default registerDrag;\n","import { initWidget } from './widget.js';\nwindow.initWidget = initWidget;\n"],"names":["showSSEMessage","text","id","timeout","_a","shadowRoot","document","getElementById","tips","setTimeout","scrollTop","scrollHeight","getAttribute","innerHTML","classList","remove","removeAttribute","setAttribute","add","randomSelection","obj","Array","isArray","Math","floor","random","length","randomOtherOption","total","excludeIndex","idx","loadExternalResource","url","type","Promise","resolve","reject","tag","createElement","src","onload","onerror","head","appendChild","generateMsgId","replace","c","r","toString","LocalStoreage_Key","getLocalStorage","key","data","localStorage","getItem","value","expire","JSON","parse","Date","now","writeOptions","options","oldOptions","Object","assign","console","info","setItem","stringify","setLocalStorage","readOptions","Logger","constructor","level","this","setLevel","shouldLog","levelOrder","error","message","args","warn","log","trace","logger","ModelManager","config","models","modelList","apiPath","cdnPath","cubism2Path","cubism5Path","useCDN","endsWith","modelId","parseInt","modelTexturesId","isNaN","_modelId","_modelTexturesId","currentModelVersion","loading","modelJSONCache","initCheck","model","response","fetch","json","modelName","modelSettingPath","modelSetting","fetchWithCache","checkModelVersion","textureCache","loadTextureCache","paths","resetCanvas","result","Version","FileReferences","loadLive2D","version","cubism2model","default","Cubism2Model","import","cubism5model","release","gl","changeModelWithJSON","init","AppDelegate","Cubism5Model","destroy","subdelegates","at","changeModel","initialize","run","err","loadModel","textures","loadRandTexture","successMessage","failMessage","noTextureAvailable","loadNextModel","messages","ToolsManager","tools","hitokoto","icon","callback","async","template","_","i","i18n","from","creator","asteroids","window","Asteroids","ASTEROIDSPLAYERS","push","script","changeSuccess","changeFail","photo","canvas","imageUrl","toDataURL","link","style","display","href","download","body","click","removeChild","open","quit","goodbye","waifu","waifuToggle","registerTools","keys","saveHightlightText","loadingCallback","interval","setInterval","weightedTexts","Text","Weight","title","location","getTime","getWeightedTexts","method","headers","texts","then","res","clearInterval","catch","saveDaily","original","time","input","generate","getDaily","doneCallback","map","item","arr","content","split","innerText","substring","userInput","join","fetchEventSource","onopen","ok","onmessage","line","event","payload","onclose","registerEventListener","userActionTimer","userAction","messageArray","lastHoverElement","seasons","forEach","date","after","before","Number","getMonth","getDate","String","getFullYear","addEventListener","selector","mouseover","target","closest","dblclickLoading","isInContainer","current","parentElement","str","hoverBody","tapBody","copy","hidden","visibilitychange","out","getKanbanDaily","detail","saveText","e","rect","getBoundingClientRect","clientX","right","clientY","top","getShadowRootMounted","mounted","loadWidget","pauseUse","removeItem","sessionStorage","insertAdjacentHTML","waifuPath","pauseRecord","drag","element","winWidth","innerWidth","winHeight","innerHeight","imgWidth","offsetWidth","imgHeight","offsetHeight","button","preventDefault","_offsetX","offsetX","_offsetY","offsetY","onmousemove","_x","_y","_left","_top","left","onmouseup","onresize","registerDrag","initWidget","logLevel"],"mappings":"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"}